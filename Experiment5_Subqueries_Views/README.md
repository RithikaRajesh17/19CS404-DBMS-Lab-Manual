# Experiment 5: Subqueries and Views

## AIM
To study and implement subqueries and views.

## THEORY

### Subqueries
A subquery is a query inside another SQL query and is embedded in:
- WHERE clause
- HAVING clause
- FROM clause

**Types:**
- **Single-row subquery**:
  Sub queries can also return more than one value. Such results should be made use along with the operators in and any.
- **Multiple-row subquery**:
  Here more than one subquery is used. These multiple sub queries are combined by means of ‘and’ & ‘or’ keywords.
- **Correlated subquery**:
  A subquery is evaluated once for the entire parent statement whereas a correlated Sub query is evaluated once per row processed by the parent statement.

**Example:**
```sql
SELECT * FROM employees
WHERE salary > (SELECT AVG(salary) FROM employees);
```
### Views
A view is a virtual table based on the result of an SQL SELECT query.
**Create View:**
```sql
CREATE VIEW view_name AS
SELECT column1, column2 FROM table_name WHERE condition;
```
**Drop View:**
```sql
DROP VIEW view_name;
```

**Question 1**

Write a SQL query that retrieves the names of students and their corresponding grades, where the grade is equal to the maximum grade achieved in each subject.

Sample table: GRADES (attributes: student_id, student_name, subject, grade)


```sql
select student_name,grade from grades g
where g.grade = (select  MAX(g2.grade)
                 from grades g2
                 where g2.subject = g.subject);
```

**Output:**

![image](https://github.com/user-attachments/assets/c1758651-2bc7-4b52-94aa-140cad0bcd03)


**Question 2**

Write a SQL query to List departments with names longer than the average length

Departments Table (attributes: department_id, department_name)


```sql
SELECT department_id as depar, department_name
FROM Departments
WHERE LENGTH(department_name) > (
    SELECT AVG(LENGTH(department_name)) FROM Departments
);

```

**Output:**

![image](https://github.com/user-attachments/assets/c6a5f2e6-4f61-48db-b2f4-c72c228eb8ce)


**Question 3**

Write a SQL query to retrieve all columns from the CUSTOMERS table for customers whose salary is EQUAL TO $1500.
```
Sample table: CUSTOMERS

ID          NAME        AGE         ADDRESS     SALARY
----------  ----------  -------- ----------  ----------

1          Ramesh       32          Ahmedabad     2000
2          Khilan       25          Delhi         1500
3          Kaushik      23          Kota          2000
4          Chaitali     25          Mumbai        6500
5          Hardik       27          Bhopal        8500
6          Komal        22          Hyderabad     4500
7          Muffy        24          Indore        10000

```
 
```sql
SELECT * from CUSTOMERS
WHERE SALARY=1500;
```

**Output:**

![image](https://github.com/user-attachments/assets/450c8933-6604-4de3-af1b-5b8e0c936738)

**Question 4**
From the following tables, write a SQL query to find all orders generated by the salespeople who may work for customers whose id is 3007. Return ord_no, purch_amt, ord_date, customer_id, salesman_id.
```
Table Name: orders

name             type
---------------  --------
order_no         int
purch_amt        real
order_date       text
customer_id      int
salesman_id      int
```
```sql
select ord_no,purch_amt,ord_date,customer_id,salesman_id
from orders 
where salesman_id =(
    select salesman_id 
    from orders 
    where customer_id=3007
);
```

**Output:**

![image](https://github.com/user-attachments/assets/1fe61767-8ef6-46dd-bbeb-6d73feeee28b)


**Question 5**
From the following tables write a SQL query to find all orders generated by New York-based salespeople. Return ord_no, purch_amt, ord_date, customer_id, salesman_id.
```
salesman table

name             type
---------------  ---------------
salesman_id      numeric(5)
name             varchar(30)
city             varchar(15)
commission       decimal(5,2)

orders table

name             type
---------------  --------
order_no         int
purch_amt        real
order_date       text
customer_id      int
salesman_id      int
```

```sql
select ord_no,purch_amt,ord_date,customer_id,salesman_id from orders
WHERE salesman_id IN(select salesman_id from salesman where city = 'New York');
```

**Output:**

![image](https://github.com/user-attachments/assets/6b6c3f52-6b95-4599-9a0b-e15c2e67a63f)


**Question 6**
From the following tables write a SQL query to find all orders generated by London-based salespeople. Return ord_no, purch_amt, ord_date, customer_id, salesman_id.
```
salesman table

name             type
---------------  ---------------
salesman_id      numeric(5)
name             varchar(30)
city             varchar(15)
commission       decimal(5,2)

orders table

name             type
---------------  --------
order_no         int
purch_amt        real
order_date       text
customer_id      int
salesman_id      int
```
```sql
SELECT  ord_no,purch_amt,ord_date,customer_id,salesman_id
FROM orders
where salesman_id In(
      select salesman_id
      from salesman 
      where city ='London'
);
```

**Output:**

![image](https://github.com/user-attachments/assets/1542a4be-90b9-4dd3-9017-438364bbcd74)


**Question 7**
Write a SQL query to Retrieve the medications with dosages equal to the lowest dosage

Table Name: Medications (attributes: medication_id, medication_name, dosage)

```sql
SELECT medication_id as medic,medication_name,dosage
from Medications
where dosage IN(select MIN(dosage) from Medications);
```

**Output:**

![image](https://github.com/user-attachments/assets/ffd45e30-73f9-46c6-8d59-59e1579043e8)


**Question 8**
Write a SQL query that retrieves the all the columns from the Table Grades, where the grade is equal to the minimum grade achieved in each subject.

Sample table: GRADES (attributes: student_id, student_name, subject, grade)

```sql
select * from GRADES g
where g.grade = (SELECT MIN(g2.grade)from Grades g2 where g2.subject=g.subject);
```

**Output:**

![image](https://github.com/user-attachments/assets/67d1929d-8466-444e-9bdd-dbefe42aacc4)

**Question 9**
Write a SQL query to retrieve all columns from the CUSTOMERS table for customers whose AGE is LESS than $30
```
Sample table: CUSTOMERS

ID          NAME        AGE         ADDRESS     SALARY
----------  ----------  ----------  ----------  ----------

1          Ramesh        32           Ahmedabad     2000
2          Khilan        25           Delhi         1500
3          Kaushik       23           Kota          2000
4          Chaitali      25           Mumbai        6500
5          Hardik        27           Bhopal        8500
6          Komal         22           Hyderabad     500
7          Muffy         24           Indore        10000
```
```sql
select * from CUSTOMERS WHERE age<30 order by ID;
```

**Output:**

![image](https://github.com/user-attachments/assets/8fb5a23e-67c1-466b-86f2-fa9f706f69a0)

**Question 10**
Write a SQL query that retrieves the names of students and their corresponding grades, where the grade is equal to the minimum grade achieved in each subject.

Sample table: GRADES (attributes: student_id, student_name, subject, grade)

```sql
select student_name,grade from GRADES g 
where g.grade =(select MIN(g2.grade)from GRADES g2 where g2.subject=g.subject);
```

**Output:**

![image](https://github.com/user-attachments/assets/5e699fde-8558-4792-81a6-0d7de3c2d0e7)

## RESULT
Thus, the SQL queries to implement subqueries and views have been executed successfully.

![image](https://github.com/user-attachments/assets/bd66e19b-74c2-4e53-92c0-3cc2a5643322)

